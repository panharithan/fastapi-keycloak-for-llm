version: "3.9"

services:
  app:
    build: .
    container_name: fastapi-keycloak-app
    ports:
      - "8000:8000"  # FastAPI
      - "7860:7860"  # Gradio
    env_file: .env
    environment:
      # üîë Keycloak Configuration
      KEYCLOAK_URL: http://keycloak:${KEYCLOAK_PORT}
      KEYCLOAK_REALM: ${KEYCLOAK_REALM}
      CLIENT_ID: ${CLIENT_ID}
      CLIENT_SECRET: ${CLIENT_SECRET}
      KEYCLOAK_TOKEN_URL: http://keycloak:${KEYCLOAK_PORT}/realms/${KEYCLOAK_REALM}/protocol/openid-connect/token
      VERIFY_URL: ${VERIFY_URL:-http://keycloak:${KEYCLOAK_PORT}/verify}
      PUBLIC_BASE_URL: "${PUBLIC_BASE_URL}"

      # üìß Email Configuration
      EMAIL_HOST_USER: ${EMAIL_HOST_USER}
      EMAIL_HOST_PASSWORD: ${EMAIL_HOST_PASSWORD}
      SMTP_HOST: ${SMTP_HOST:-smtp.gmail.com}

      # üçÉ External MongoDB Configuration
      MONGO_USER: ${MONGO_USER}
      MONGO_PASS: ${MONGO_PASS}
      MONGO_HOST: ${MONGO_HOST}
      MONGO_DB_PORT: ${MONGO_DB_PORT}
      MONGO_DB: ${MONGO_DB}
      ENCRYPTION_KEY: ${ENCRYPTION_KEY}

    networks:
      - llm-net
    extra_hosts:
      - "host.docker.internal:host-gateway"

networks:
  llm-net:
    external: true
